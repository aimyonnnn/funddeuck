<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.test.mapper.MemberMapper">

	<!-- 회원 정보 조회하기 -->
	<select id="selectMember">
		SELECT * 
			FROM members
				WHERE member_id = #{id}
		
	</select>
	
	<!-- 회원 가입 -->
	<insert id="insertMember">
		INSERT INTO members
			VALUES(
				null
				,#{member_name}
				,#{member_id}
				,#{member_passwd}
				,#{member_email}
				,#{member_phone}
				,0
			)
	</insert>
	
	<!-- 이메일 인증 코드 저장 -->
	<insert id="insertEmailDuplicate">
		INSERT INTO email 
			VALUES(
				#{email}
				, #{authCode}
			);
	</insert>
	
	<!-- 이메일 존재 여부 확인 -->
	<select id="selectEmail" resultType="int">
		SELECT COUNT(*)
		FROM email
		WHERE email = #{email}
	</select>
	
	<!-- 이메일 인증 코드 업데이트 -->
	<update id="updateEmailAuthCode">
		UPDATE email
		SET authCode = #{authCode}
		WHERE email = #{email}
	</update>
	
	<!-- 인증코드가 일치한지 확인 -->
	<select id="isAuthCode">
		SELECT COUNT(*)
			FROM email
			WHERE email = #{email} and authCode = #{authCode}
	</select>
	
	<!-- 인증코드가 일치할시 삭제 -->
	<delete id="deleteAuthCode">
		DELETE FROM email
			WHERE email = #{email} and authCode = #{authCode}
	</delete>
	
	<update id="updateFailCount">
		UPDATE members
		SET false_count = #{false_count}
		WHERE member_id = #{member_id}
	</update>
	
</mapper>
