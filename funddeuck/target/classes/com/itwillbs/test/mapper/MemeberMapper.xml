<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.test.mapper.MemberMapper">

	<!-- 회원 정보 조회하기 -->
	<select id="selectMember">
		SELECT * 
			FROM members
				WHERE member_id = #{id}
		
	</select>
	
	<!-- 회원 가입 -->
	<insert id="insertMember">
		INSERT INTO members
			VALUES(
				null
				,#{member_name}
				,#{member_id}
				,#{member_passwd}
				,#{member_email}
				,#{member_phone}
			)
	</insert>
	
	<insert id="insertEmailDuplicate">
		INSERT INTO email 
			VALUES(
				#{email}
				, #{authCode}
			);
	</insert>
	
	<select id="selectEmail" resultType="int">
		SELECT COUNT(*)
		FROM email
		WHERE email = #{email}
	</select>
	
	<update id="updateEmailAuthCode">
		UPDATE email
		SET authCode = #{authCode}
		WHERE email = #{email}
	</update>
	
	<select id="isAuthCode">
		SELECT COUNT(*)
			FROM email
			WHERE email = #{email} and authCode = #{authCode}
	</select>
	
	<delete id="deleteAuthCode">
		DELETE FROM email
			WHERE email = #{email} and authCode = #{authCode}
	</delete>
	
	<!-- url 판별 -->
	<select id="selectIdx" resultType="com.itwillbs.test.vo.MembersVO">
 	 	SELECT 
		   IFNULL(ma.maker_idx, 0) AS maker_idx,
		   IFNULL(r.reward_idx, 0) AS reward_idx,
		   IFNULL(p.project_idx, 0) AS project_idx
		FROM 
		    maker ma
			LEFT JOIN members m ON m.member_idx = ma.member_idx
			LEFT JOIN project p ON ma.maker_idx = p.maker_idx AND p.project_approve_status = 1
			LEFT JOIN reward r ON p.project_idx = r.project_idx
		WHERE 
	    	m.member_id = #{sId}
	</select> 
	
</mapper>
