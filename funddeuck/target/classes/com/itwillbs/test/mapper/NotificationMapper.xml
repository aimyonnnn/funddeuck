<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.test.mapper.NotificationMapper">
  	
  	<!-- 저장 -->
	<insert id="insertNotification">
		insert
			into notification
				values(
				null                      -- 알림번호
				, #{target}               -- 회원아이디
				, #{content}              -- 알림내용
				, now()	                  -- 알림날짜
				, 1                       -- 알림상태: 1-읽지 않음, 2-읽음'	
				)
	</insert>
	
	<!-- 갯수 조회 -->
	<select id="selectNotificationCount" resultType="int">
		select count(*)
			from notification
				where member_id = #{member_id}
				and notification_read_status = 1
	</select>	
	
	<!-- 리스트 조회 & 내림차순 정렬-->
	<select id="selectNotificationList" resultType="com.itwillbs.test.vo.NotificationVO">
		select *
			from notification
				where member_id = #{sId}
				order by notification_regdate desc
	</select>
	
	<!-- 읽음 처리 -->
	<update id="updateNotificationStatus">
		update notification
			set
				notification_read_status = 2
			where
				notification_idx = #{notification_idx}
	</update>
  	
  	<!-- 전체 읽음 처리 -->
  	<update id="updateAllNotificationStatus">
  		update notification
  			set
  				notification_read_status = 2
  			where
  				member_id = #{member_id}
  	</update>
  	
  	<!-- 안읽은 메시지 조회 -->
  	<select id="selectUnreadNotificationList">
  		select *
  			from notification
  				where
  					member_id = #{sId}
  					and notification_read_status = 1
  				order by notification_regdate desc
  	</select>
  
</mapper>



